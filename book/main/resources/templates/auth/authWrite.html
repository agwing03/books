<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/basic">
    <th:block layout:fragment="title">
        <title>글작성 페이지</title>
    </th:block>

    <th:block layout:fragment="content">
    <form id="saveForm" name="saveForm" method="post">
    	<div class="search_field">
		    <div class="search_field_loc">
		    	<h5 th:if="${auth != null}">
		    		<strong>권한 수정</strong>
		    	</h5>
		    	<h5 th:if="${auth == null}">
		    		<strong>권한 등록</strong>
		    	</h5>
		    	<ul class="buttons">
		    		<li><a onclick="fn_select_search();"><img src="/images/tapCmm/save.svg"><p>뒤로가기</p></a></li>
	                <li><a onclick="fn_saveAuth();"><img src="/images/tapCmm/edit.svg"><p>저장하기</p></a></li>
		    	</ul>
		    </div>
	    </div>
	    
	    <div class="modify_user">
            <table>
            	<colgroup>
            		<col width="10%">
            		<col width="*%">
            	</colgroup>
            	<tbody>
            		<tr>
            			<th>권한 ID</th>
            			<td th:if="${auth == null}">
            				<input type="text" id="authId" name="authId" class="form-control" maxlength="50" placeholder="ID를 입력해 주세요." />
            			</td>
            			<td th:if="${auth != null}">
            				<input type="text" id="authId" name="authId" class="form-control" readonly="readonly" maxlength="50" placeholder="ID를 입력해 주세요." />
            			</td>
            		</tr>
            		<tr>
            			<th>권한명</th>
            			<td>
            				<input type="text" id="authNm" name="authNm" class="form-control" maxlength="10" placeholder="권한명을 입력해 주세요." />
            			</td>
            		</tr>
            	</tbody>
            </table>
        </div>
    </form>
    </th:block>

    <th:block layout:fragment="script">
        <script th:inline="javascript">
         /*<![CDATA[*/

        	$(document).ready(function() {
        		// 상세정보 렌더링 정보가없으면 공백출력
            	renderPostInfo();
            });
         
        	// 뒤로가기
			function fn_select_search() {
				$("#saveForm").attr("action", "/auth/list.do");
				$("#saveForm").submit();
			}

        	// 권한 저장(수정)
            function fn_saveAuth() {
        		
        		// 데이터 체크
        		if( !fn_chkData() ) {
        			return false;
        		}
        		
        		// 권한 저장
        		action_popup.confirm("권한을 수정하시겠습니까?", fn_saveAuthAjax);
        		
        	}
        	// 권한 저장(수정) ajax
        	function fn_saveAuthAjax() {
        		
        		let data = $("#saveForm").serializeObject();
        		
        		const url = [[ ${auth == null} ]] ? '/auth/save.do' : '/auth/update.do';
        		
        		$.ajax({
	            	url : url
	            	,type : "POST"
	            	,data : JSON.stringify(data)
	            	,dataType : "text"
	            	,contentType: "application/json;charset=UTF-8"
	            	,async : false
	            	,success : function (data) {
	            		// 토스트 메시지 시간 나타내기
	            		sessionStorage.setItem("msg", data);
	            		// 화면 이동
	            		fn_select_search();
	            	}, error : function(request, status, error) {
	            		action_popup.alert("E");
	            	}
	            });
        	}
         
            // 권한 상세정보 렌더링
            function renderPostInfo() {
                const auth = [[ ${auth} ]];
                
                if ( !auth ) {
                    return false;
                }

                const form = document.getElementById('saveForm');
                const fields = ['authId', 'authNm'];

                fields.forEach(field => {
                    form[field].value = auth[field];
                })
            }
            
            // 데이터 체크
            function fn_chkData() {
            	
            	if($("#authId").val() == "") {
            		action_popup.alert("권한 ID는 필수 입력입니다.");
            		return false;
            	}
            	
            	if($("#authNm").val() == "") {
            		action_popup.alert("권한 이름은 필수 입력입니다.");
            		return false;
            	}

            	return true;
            }
        /*]]>*/ 
        </script>
    </th:block>
</html>