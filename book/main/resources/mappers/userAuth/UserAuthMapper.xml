<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tccins.template.userAuth.mapper.UserAuthMapper">
    
    <!-- 사용자 리스트 -->
    <select id="findAllUser" parameterType="com.tccins.template.common.dto.SearchDto" resultType="com.tccins.template.userAuth.UserAuthVO">
        SELECT
            USER_ID			
	        ,USER_NM		
	        ,USE_YN			
	        ,FAIL_COUNT		
	        ,IS_LOCK		
	        ,AUTHOR_CODE	
        FROM
            user
        WHERE
        	1 = 1
        	<if test="searchType != null and searchType != ''">
        		<choose>
        			<when test="searchType.equals('userId')">
        				AND UPPER(USER_ID) LIKE CONCAT('%',UPPER(#{keyword}), '%')        			
        			</when>
        			<when test="searchType.equals('userName')">
        				AND UPPER(USER_NM) LIKE CONCAT('%',UPPER(#{keyword}), '%')
        			</when>
        		</choose>
        	</if>
        LIMIT #{pagination.limitStart}, #{recordSize}
    </select>
    
    <!-- 사용자 수 카운팅 -->
    <select id="userCount" parameterType="com.tccins.template.common.dto.SearchDto" resultType="int">
        SELECT
            COUNT(*)
        FROM
            user
        WHERE
			1 = 1
			<if test="searchType != null and searchType != ''">
        		<choose>
        			<when test="searchType.equals('userId')">
        				AND UPPER(USER_ID) LIKE CONCAT('%',UPPER(#{keyword}), '%')        			
        			</when>
        			<when test="searchType.equals('userName')">
        				AND UPPER(USER_NM) LIKE CONCAT('%',UPPER(#{keyword}), '%')
        			</when>
        		</choose>
        	</if>
    </select>
    
    <!-- 권한 전체 조회 -->
    <select id="authList" parameterType="com.tccins.template.common.dto.SearchDto" resultType="com.tccins.template.auth.AuthVO">
    	SELECT
    		 AUTH_ID
    		,AUTH_NM
    	FROM
    		AUTH
    	WHERE
    		1=1
    </select>
    
    <!-- 권한 수정 -->
    <update id="userAuthUpdate" parameterType="com.tccins.template.common.CamelMap">
    	UPDATE USER SET
    		AUTHOR_CODE = #{authorCode}
    	WHERE USER_ID = #{userId}
    </update>
</mapper>