<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>HTML5 Document type</title>
    <script src="http://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="/css/cmmn.css"/>
    <script src="/js/cmmn.js"></script>
    
    <script>
		$(document).ready(function(){
    		//데이터 목록 검색
			search()
  		});
  		
  		// 목록 데이터 조회
		function srchList(params){
			let listHtml = null
			fetchApi('/book/getBookList.do', 'POST', params, 'dataList')
				.then((data) => {
					$("#dataList").empty()
					if(data != null){
						for(var i = 0; i < data.length; i++){
							listHtml += 	
								'<tr onclick="viewForm('+data[i].bookNo+');" id="'+data[i].bookNo+'">'+
								'	<td width="8%">'+data[i].bookNo+'</td>'+
								'	<td width="27%" align="left"><a href="javascript:viewForm();">'+data[i].bookTitle+'</a></td>'+
								'	<td width="auto" align="left">'+data[i].bookWriter+'</td>'+
								'	<td width="7%">'+data[i].bookApp+'</td>'+
								'	<td width="5%">'+data[i].bookAvg+'</td>'+
								'	<td width="15%">'+data[i].frstRegDt+'</td>'+
								'</tr>'
						}
						$("#dataList").append(listHtml);						
					}else{
						$("#dataList").append('<tr><td colspan="6">데이터가 존재하지 않습니다.</td></tr>');
					}
				}).catch((error) => console.log(error))
		}
		
		//수정폼 데이터 전달 
		function viewForm(id){
			let row = $("#"+id).children('td')
			$("#saveData").empty()
			let html = 
				'<tr>'+
				'	<td><input type="text" value="'+row.eq(0).text()+'" readonly></td>'+
				'	<td><input type="text" value="'+row.eq(1).text()+'"></td>'+
				'	<td><input type="text" value="'+row.eq(2).text()+'"></td>'+
				'</tr>'
			$("#saveData").append(html);
		}		
		//등록폼 row 추가
		function addViewForm(){
			let key = $("#saveData tr").children('td').eq(0).find('input').val()
			if(key != '' && key != undefined){
				$("#saveData").empty()	
			}
			let html = 
				'<tr>'+
				'	<td><input type="text" value="" readonly></td>'+
				'	<td><input type="text" value=""></td>'+
				'	<td><input type="text" value=""></td>'+
				'</tr>'
			$("#saveData").append(html);
		}
	</script>
</head>
<body>
   <!--공통 헤더-->
   	<header></header>
   	<!--공통 네비-->
   	<nav></nav>
   	<!--공통 사이드 메뉴-->
   	<aside></aside>
   	<section>
		<article>
			<h3>독서 목록</h3>
			<!-- 검색 -->
			<div id="srchBox">
				<!-- 검색조건 -->
				<select id="srchGbn">
					<option value="B">도서명</option>
					<option value="W">작가</option>
				</select>
				<input type="text" id="srchText">
				<!-- 검색 -->
				<a href="javascript:search();" id="serch" class="w-btn-neon2" type="button">검색</a>
			</div>
			<!-- 데이터 테이블 -->	
			<table class="listTable">
				<col>
					<col></col>
				</colgroup>
				<thead>
					<tr>
						<th width='6%'>No</th>
						<th width='25%'>도서명</th>
						<th width='auto'>작가</th>
						<th width='5%'>참석수</th>
						<th width='5%'>평점</th>
						<th width='14%'>생성일</th>
					</tr>
				</thead>
				<tbody id="dataList"></tbody>
			</table>
		</article>
		<article>
			<table class="inputTable">
				<thead>
					<tr>
						<th>도서번호</th>
						<th>도서명</th>
						<th>작가</th>
					<tr>
				</thead>
				<tbody id="saveData">
					<tr>
						<td><input type="text" readonly ></td>
						<td><input type="text"></td>
						<td><input type="text"></td>
					</tr>
				</tbody>
			</table>
			<div class="btnDiv">
				<a href="javascript:save('/book/setBook.do','I');">등록</a>
				<a id='addRow' href="javascript:addViewForm();">추가</a>
			</div>
		</article>
   	</section>
   	<!--공통 풋터-->
   	<footer></footer>
</body>
</html>