<script src="/dist/js/tabulator.js"></script> 
<script src="/dist/js/jquery_wrapper.js"></script>  
<script>
	jQuery(document).ready(function(){
        //목록 데이터 조회
        jQuery("#srchBtn").click(function () {
			srchList(tableLayout, srchParam())
		})
		
		//초기 목록 조회
		//srchList(tableLayout, srchParam())
		
		//L 맴버 폼 추가
		jQuery("#addMemberBtn").click(function () {
			addMember()
		})
		
		//L 모임 저장 
		jQuery("#saveMeetingBtn").click(function () {
			saveMeeting()
		})
		
		//신규 맴버 저장 
		jQuery("#saveNewMemberBtn").click(function () {
			saveNewMember()
		})
		//신규 도서 저장 
		jQuery("#saveNewBookBtn").click(function () {
			saveNewBook()
		})
		
		
		//시간, 분
		for(var i = 7 ; i < 22; i++){
			var html = "<option value="+i+">"+i+"</option>"
			jQuery("#timeHour").append(html) 		    
		}
		for(var i = 1 ; i < 60; i++){
			var html = "<option value="+i+">"+i+"</option>"
			jQuery("#timeMinute").append(html) 		    
		}
	})
	
	// 목록 데이터 조회
	function srchList(tableLayout, params){ 
		fetchApi('/book/getBookList.do', 'POST', params, 'dataList')
			.then((data) => {
				if(data != null){
					tableLayout.setData(data)
				}else{
					alert("데이터 없음")
				}
			}).catch((error) => console.log(error))
	}
	
	/** 화면 동적 변경 **/
	// 맴버 form 추가 
	var addNum = 1
	function addMember(){
		addNum+= 1
		let html = 
			'<div class="mt-8" id="memberForm'+addNum+'">'+
			'	<div class="flex flex-col sm:flex-row items-center mt-3">'+
			'		<input type="text" class="form-control mr-2" placeholder="참석자" style="width: 150px;" id="memberNm'+addNum+'">'+
			'		<input type="hidden" id="mamberNo'+addNum+'">'+
			'		<input type="text" class="form-control" placeholder="도서명" id="bookTitle'+addNum+'">'+
			'		<input type="hidden" id="bookNo'+addNum+'">'+
			'	</div>'+
			'	<div class="flex flex-col sm:flex-row items-center mt-3">'+
			'		<input type="text" class="form-control mr-2" placeholder="한줄평" id="eval'+addNum+'">'+
			'		<input type="text" class="form-control mr-2" placeholder="평점 10.0" style="width: 150px;" id="score'+addNum+'">'+
			'		<button class="btn btn-danger ml-auto" onclick="delMember(\'memberForm'+addNum+'\')"><i data-lucide="minus" class="w-5 h-5"></i></button>'+
			'	</div>'+
			'</div>'
		jQuery("#memberForm").append(html);
	}
	
	// 맴버 form 삭제 
	function delMember(target){ 
		jQuery('#'+target).remove();
	}
	
	
	/** 서버 등록 **/
	// 맴버 등록 
	function saveMeeting(){ 
		var review = []
		var saveData = {
			'title':jQuery('#title').val(),
			'meetingGbn':jQuery('#meetingGbn').val()
		}
		var member 
		for(var i = 1; i <= addNum; i++){
			review.push({
				'mamberNo': jQuery('#mamberNo'+i).val(),
				'bookNo': jQuery('#bookNo'+i).val(),
				'bookEval': jQuery('#eval'+i).val(),
				'bookScore': jQuery('#score'+i).val()
			})
		}
		saveData.reviewList = review
		if(saveData){
			fetchApi('/club/saveMeetingReview.do', 'POST', saveData, 'save')
		}
	}
	
	// 신규 맴버 등록
	function saveNewMember(){ 
		var saveData = {
			'saveFlag':'I',
			'name':jQuery('#memberNm').val(),
			'nickNm':jQuery('#nickNm').val(),
			'brthday':jQuery('#brthday').val(),
			'joinDt':jQuery('#joinDt').val(),
			'sex':jQuery('input[name=sex]').val(),
			'actionAreaLv1':jQuery('#actionAreaLv1').val(),
			'actionAreaLv2':jQuery('#actionAreaLv2').val(),
			'email':jQuery('#email1').val()+'@'+jQuery('#email2').val(),
			'phonNo':jQuery('#phonNo1').val()+'-'+jQuery('#phonNo2').val()+'-'+jQuery('#phonNo3').val()
		}
		if(saveData){
			fetchApi('/club/saveMember.do', 'POST', saveData, 'save')
		}
	}
	
	// 신규 도서 등록
	function saveNewBook(){ 
		var saveData = {
			'bookNo':jQuery('#bookNoL1').val(),
			'bookTitle':jQuery('#bookTitleL1').val(),
			'bookWriter':jQuery('#bookWriterL1').val()
		}
		if(saveData){
			fetchApi('/book/saveBook.do', 'POST', saveData, 'save')
		}
	}
	
	
	/** 실시간 검색 기능 **/
	// 도서 실시간 검색
	function getSrchBook(text, num){
		if(text.length > 1){
			var params = {"srchText":text}
			fetchApi('/book/selectBookSrch.do', 'POST', params, 'dataList')
			.then((data) => {
				if(data != null){
					jQuery('#bookSrchBox'+num).empty()
					for(var i = 0; i < data.length; i++){
						let html = '<li><a href="#" onclick="setSrchBookData(\''+num+'\',\''+data[i].bookNo+'\',\''+data[i].bookTitle+'\',\''+data[i].bookWriter+'\')">'+data[i].bookInfo+'</a></li>'
						jQuery('#bookSrchBox'+num).append(html)
					}
				}
			}).catch((error) => console.log(error))
		}
	}
	
	// 맴버 실시간 검색
	function getSrchMember(text, num){
		if(text.length > 1){
			var params = {"srchText":text}
			fetchApi('/member/selectMemberSrch.do', 'POST', params, 'dataList')
			.then((data) => {
				if(data != null){
					jQuery('#memberSrchBox'+num).empty()
					for(var i = 0; i < data.length; i++){
						let html = '<li><a href="#" onclick="setSrchMemberData(\''+num+'\',\''+data[i].memberNo+'\',\''+data[i].name+'\')">'+data[i].name+'</a></li>'
						jQuery('#memberSrchBox'+num).append(html)
					}
				}
			}).catch((error) => console.log(error))
		}
	}
	
	// 실시간 리턴 데이터셋 
	function setSrchBookData(num, bookNo, bookTitle, bookWriter){
		jQuery('#bookNo'+num).val(bookNo)
		jQuery('#bookTitle'+num).val(bookTitle)
		jQuery('#bookWriter'+num).val(bookWriter)
		jQuery('#bookSrchBox'+num).empty()
	}
	function setSrchMemberData(num, memberNo, memberNm){
		jQuery('#memberNo'+num).val(memberNo)
		jQuery('#memberNm'+num).val(memberNm)
		jQuery('#memberSrchBox'+num).empty()
	}
</script> 

<div class="intro-y flex items-center mt-8">
    <h1 class="text-lg font-medium mr-auto">Meeting Create Form</h1>
</div>
<div class="grid grid-cols-12 gap-6 mt-5">

	<!-- 좌측 폼 -->
    <div class="intro-y col-span-12 lg:col-span-6">
        <!-- BEGIN: Input -->
        <div class="intro-y box">
            <div class="flex flex-col sm:flex-row items-center p-5 border-b border-slate-200/60 dark:border-darkmode-400">
                <h2 class="font-medium text-base mr-auto">Meeting Info</h2>
                <button class="btn btn-primary w-35" id="saveMeetingBtn"><i data-lucide="plus" class="w-5 h-5"></i>저장</button>
            </div>
            <div id="input" class="p-5">
                <div class="preview">
                	<!-- 모임타이틀 / 구분 -->
                    <div class="flex flex-col sm:flex-row items-center">
                    	<input type="text" class="form-control mr-2" placeholder="제목" id="title">
						<select class="form-select" aria-label="Default select example" style="width: 150px;" id="meetingGbn">
                            <option value="MEETING">정기모임</option>
                            <option value="SPECIAL">이벤트</option>
                            <option value="SUDDENLY">벙개</option value="">
                            <option value="APPOINTED">지정도서</option value="">
                        </select>
                    </div>
                    <div class="flex flex-col sm:flex-row items-center mt-2">
                    	<input type="text" class="form-control" placeholder="주체자" style="width: 150px;" id="hostNm" value="박지열">
                    	<input type="hidden" id="hostNo" value="1">
                    </div>
                    <div class="flex flex-col sm:flex-row items-center mt-2">
                    	<input type="text" class="datepicker form-control w-56 block mr-2" data-single-mode="true" style="width: 150px;" id="dday" value="20231217"> 
                        <select class="form-select mr-2" aria-label="Default select example" style="width: 80px;" id="timeHour">
                            <option value="17">17</option>
                        </select>
                        <select class="form-select" aria-label="Default select example" style="width: 80px;" id="timeMinute">
                            <option value="00">00</option>
                        </select>
                    </div>
                    <div class="flex flex-col sm:flex-row items-center mt-2">
                    	<input type="text" class="form-control mr-2" placeholder="장소" id="place" value="책과 삶" style="width: 150px;">
                    </div>
                    <div class="flex flex-col sm:flex-row items-center mt-2">
                        <input type="text" class="form-control mr-2" placeholder="참가비" id="cost" value="개인음료+@" style="width: 150px;">
                    </div>
                    <div class="flex flex-col sm:flex-row items-center mt-2">
                        <input type="text" class="form-control mr-2" placeholder="인원" id="attendCnt" value="8" style="width: 80px;">명
                    </div>
                    
                    
        			<!-- 참석자 추가 영역-->        
                    <div class="flex flex-col sm:flex-row items-center mt-8">
                    	<h2 class="font-medium text-base mr-auto ">Member</h2>
                    	<button class="btn btn-primary w-35" id="addMemberBtn"><i data-lucide="plus" class="w-5 h-5"></i>Add</button>
                    </div>
                    <div id="memberForm">
						<div class="mt-3" id="memberForm1">
		                    <div class="flex flex-col sm:flex-row items-center mt-3">
		                    	<!-- 참석자 -->
		                        <div class="dropdown mr-2" style="width: 150px;">
		                      		<input type="text" class="form-control dropdown-toggle" aria-expanded="false" data-tw-toggle="dropdown" placeholder="참석자" id="memberNm1" onkeyup="getSrchMember(this.value, '1');">
								    <div class="dropdown-menu w-40">
								        <ul class="dropdown-content overflow-y-auto h-32" id="memberSrchBox1"></ul>
								    </div>
								</div>
		                        <!-- 도서명 -->
		                      	<div class="dropdown" style="width: 100%;">
		                      		<input type="text" class="form-control dropdown-toggle" aria-expanded="false" data-tw-toggle="dropdown" placeholder="도서명" id="bookTitle1" onkeyup="getSrchBook(this.value, '1');">
								    <div class="dropdown-menu w-full">
								        <ul class="dropdown-content overflow-y-auto h-32" id="bookSrchBox1"></ul>
								    </div>
								</div>
								<input type="hidden" id="memberNo1">
								<input type="hidden" id="bookNo1">
		                    </div>
		                    <div class="flex flex-col sm:flex-row items-center mt-3">
		                    	<!-- 한줄평 -->
		                        <input type="text" class="form-control mr-2" placeholder="한줄평" id="eval1">
		                        <!-- 평점 -->
		                        <input type="text" class="form-control" placeholder="평점 10.0" style="width: 150px;" id="score1">
		                    </div>
	                    </div>
					</div>
					
					<!-- 코멘트 -->
					<div class="flex flex-col sm:flex-row items-center mt-8">
                    	<h2 class="font-medium text-base mr-auto ">Comment</h2>
                    </div>
					<div class="mt-3">
						<div class="flex flex-col sm:flex-row items-center mt-3">
	                        <input type="text" class="form-control mr-2" id="comment">
	                    </div>
					</div>
                </div>
            </div>
        </div>
        <!-- END: Select Options -->
    </div>
    
    
    
    <!-- 우측 폼 -->
    <div class="intro-y col-span-12 lg:col-span-6">
        <!-- 도서 -->
        <div class="intro-y box">
            <div class="flex flex-col sm:flex-row items-center p-5 border-b border-slate-200/60 dark:border-darkmode-400">
                <h2 class="font-medium text-base mr-auto">New Books</h2>
                <button class="btn btn-primary w-35" id="saveNewBookBtn"><i data-lucide="plus" class="w-5 h-5"></i>저장</button>
            </div>
            <div class="p-5">
	            <div class="preview">
	                <div class="flex flex-col sm:flex-row items-center mt-3">
	                	<!-- 신규 도서 -->
	                    <div class="dropdown mr-2" style="width: 100%;">
	                  		<input type="text" class="form-control dropdown-toggle" aria-expanded="false" data-tw-toggle="dropdown" placeholder="신규 도서" id="bookTitleL1" onkeyup="getSrchBook(this.value, 'L1');">
						    <div class="dropdown-menu w-full">
						        <ul class="dropdown-content overflow-y-auto h-32" id="bookSrchBoxL1"></ul>
						    </div>
						</div>
						<input type="hidden" id="bookNoL1">
	                    <!-- 저자 -->
	                    <input type="text" class="form-control" placeholder="저자" style="width: 300px;" id="bookWriterL1">
	                </div>
	            </div>
	        </div>
        </div>
        
        <!-- 맴버 -->
        <div class="intro-y box">
            <div class="flex flex-col sm:flex-row items-center p-5 border-b border-slate-200/60 dark:border-darkmode-400">
                <h2 class="font-medium text-base mr-auto">New Member</h2>
                <button class="btn btn-primary w-35" id="saveNewMemberBtn"><i data-lucide="plus" class="w-5 h-5"></i>저장</button>
            </div>
            <div class="p-5">
	            <div class="preview">
	            	<div class="flex flex-col sm:flex-row items-center mt-2">
                    	<input type="text" class="form-control mr-2" placeholder="이름" id="name">
                    	<input type="text" class="form-control" placeholder="닉네임" id="nickNm">
                    </div>
                    <div class="flex flex-col sm:flex-row items-center mt-2">
                    	<input type="text" class="form-control mr-2" maxlength="8" placeholder="생년월일" id="brthday">
                    	<input type="text" class="form-control" maxlength="8" placeholder="가입일" id="joinDt">
                    </div>
	                <div class="flex flex-col sm:flex-row items-center mt-2">
						<select class="form-select mr-2" aria-label="Default select example" style="width: 150px;" id="actionAreaLv1">
                            <option value="seoul">서울</option>
                            <option value="Incheon">인천</option>
                            <option value="gyeonggi-do">경기</option>
                        </select>
                        <select class="form-select" aria-label="Default select example" style="width: 150px;" id="actionAreaLv2">
                            <option value="MEETING">강서구</option>
                            <option value="SPECIAL">양천구</option>
                            <option value="SUDDENLY">영등포구</option>
                            <option value="APPOINTED">마포구</option>
                        </select>
                        <div class="flex flex-col sm:flex-row ml-8 mt-2">
					        <div class="form-check mr-2 mt-2 sm:mt-0"> 
					       		<input class="form-check-input" type="radio" name="sex" value="MALE" id="sexMale" > 
					        	<label class="form-check-label" for="sexMale">남성</label> 
					        </div>
					        <div class="form-check mr-2 mt-2 sm:mt-0"> 
					        	<input class="form-check-input" type="radio" name="sex" value="FEMALE" id="sexFemale"> 
					        	<label class="form-check-label" for="sexFemale">여성</label> 
					        </div>
					    </div>
                    </div>
                    <div class="flex flex-col sm:flex-row items-center mt-2">
                    	<input type="text" class="form-control mr-2" placeholder="example"  style="width: 200px;" id="email1">@
                    	<input type="text" class="form-control ml-2" placeholder="naver.com"  style="width: 200px;" id="email2"> 
                    </div>
                    <div class="flex flex-col sm:flex-row items-center mt-2">
                    	<input type="text" class="form-control mr-2" placeholder="010" value="010" style="width: 100px;" id="phonNo1">
                    	<input type="text" class="form-control mr-2" placeholder="0000" style="width: 100px;" id="phonNo2">
                    	<input type="text" class="form-control mr-12" placeholder="0000" style="width: 100px;" id="phonNo3">
                    </div>
	            </div>
	        </div>
        </div>
        <!-- END: Horizontal Form -->
    </div>
</div>